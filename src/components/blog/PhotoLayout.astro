---
import type { CollectionEntry } from 'astro:content';
import BackLink from './BackLink.astro';
import SiteHeader from './SiteHeader.astro';
import PostNav from './PostNav.astro';
import Carousel from './Carousel';
import InlineCarousel from './InlineCarousel';

interface Props {
  post: CollectionEntry<'blog'>;
  prev?: CollectionEntry<'blog'>;
  next?: CollectionEntry<'blog'>;
}

const { post, prev, next } = Astro.props;
const { title, date, location, tag, images } = post.data;

const carouselImages = images?.map((img) => ({
  src: img.src.src,
  caption: img.caption,
})) || [];

// Format date as "MMM YYYY"
const formattedDate = date.toLocaleDateString('en-US', {
  month: 'short',
  year: 'numeric',
  timeZone: 'UTC',
}).toUpperCase();
---

<div class="blog-container">
  <SiteHeader currentPage="essays" />

  <header class="blog-header">
    <BackLink label="Gallery" />
  </header>

  <main class="blog-content">
    <article>
      <header class="post-header">
        <div class="post-meta-row">
          <span class="meta-date">{formattedDate}</span>
          {location && <span class="meta-location">{location}</span>}
          {tag && <span class="meta-tag">{tag}</span>}
        </div>
        <h1 class="post-title">{title}</h1>
        <div class="article-rule"></div>
      </header>

      {carouselImages.length > 0 && (
        <InlineCarousel images={carouselImages} client:load />
      )}

      <div class="prose">
        <slot />
      </div>
    </article>

    <PostNav prev={prev} next={next} />
  </main>
</div>

{carouselImages.length > 0 && (
  <Carousel images={carouselImages} client:load />
)}

